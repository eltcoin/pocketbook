#!/usr/bin/env bash

set -euo pipefail

ENV_FILE="${1:-.env.local}"

readonly POLYGON_ADDRESS="0xec67fb9bf75d7755c60b2c3f8e8437ced3871e85"
readonly BSC_ADDRESS="0x4ED30b4fBe07463821Ff17ce2376bC4c596d3a34"
readonly ADDRESS_OPTIMISM="0x0879891f2f81736Ea9d1e33291E1f75A660b5290"
readonly ZERO_ADDRESS="0x0000000000000000000000000000000000000000"

readonly HANDLE_ZERO="0x0000000000000000000000000000000000000000"



readonly VAR_PATTERN='^(VITE_CONTRACT_ADDRESS(_(ETHEREUM|POLYGON|BSC|ARBITRUM|OPTIMISM|AVALANCHE|SEPOLIA|MUMBAI))?=)'
readonly HANDLE_PATTERN='^(VITE_HANDLE_REGISTRY_ADDRESS(_(ETHEREUM|POLYGON|BSC|ARBITRUM|OPTIMISM|AVALANCHE|SEPOLIA|MUMBAI))?=)'

tmp_file="$(mktemp)"
trap 'rm -f "$tmp_file"' EXIT

if [ -f "$ENV_FILE" ]; then
  grep -Ev "$VAR_PATTERN|$HANDLE_PATTERN" "$ENV_FILE" > "$tmp_file" || true
else
  : > "$tmp_file"
fi

cat >> "$tmp_file" <<EOF
VITE_ADDRESS_CLAIM_BYTECODE=0x
VITE_HANDLE_REGISTRY_BYTECODE=0x
VITE_BIP39_VOCABULARY_BYTECODE=0x
VITE_CONTRACT_ADDRESS=$ZERO_ADDRESS
VITE_CONTRACT_ADDRESS_ETHEREUM=$ZERO_ADDRESS
VITE_CONTRACT_ADDRESS_POLYGON=$POLYGON_ADDRESS
VITE_CONTRACT_ADDRESS_BSC=$BSC_ADDRESS
VITE_CONTRACT_ADDRESS_ARBITRUM=$ZERO_ADDRESS
VITE_CONTRACT_ADDRESS_OPTIMISM=$ADDRESS_OPTIMISM
VITE_CONTRACT_ADDRESS_AVALANCHE=$ZERO_ADDRESS
VITE_CONTRACT_ADDRESS_SEPOLIA=$ZERO_ADDRESS
VITE_CONTRACT_ADDRESS_MUMBAI=$ZERO_ADDRESS
VITE_HANDLE_REGISTRY_ADDRESS=$HANDLE_ZERO
VITE_HANDLE_REGISTRY_ADDRESS_ETHEREUM=$HANDLE_ZERO
VITE_HANDLE_REGISTRY_ADDRESS_POLYGON=0xC61D976eF7E66D8c247233daC439Ca06137b0904
VITE_HANDLE_REGISTRY_ADDRESS_BSC=0xde16Caf38e556A12f9f64d0E76bc0EbFc731ac1f
VITE_HANDLE_REGISTRY_ADDRESS_ARBITRUM=$HANDLE_ZERO
VITE_HANDLE_REGISTRY_ADDRESS_OPTIMISM=$HANDLE_ZERO
VITE_HANDLE_REGISTRY_ADDRESS_AVALANCHE=$HANDLE_ZERO
VITE_HANDLE_REGISTRY_ADDRESS_SEPOLIA=$HANDLE_ZERO
VITE_HANDLE_REGISTRY_ADDRESS_MUMBAI=$HANDLE_ZERO
EOF

mv "$tmp_file" "$ENV_FILE"

echo "Updated contract addresses in $ENV_FILE"
